# FilRelex API

## Overview

FilRelex is a comprehensive Filipino-English dictionary API featuring rich linguistic data, including Baybayin script support, word relationships, etymologies, and advanced search capabilities. This backend service provides a RESTful API for accessing and manipulating dictionary data.

## Table of Contents

- [Installation](#installation)
- [Configuration](#configuration)
- [Running the API](#running-the-api)
- [API Endpoints](#api-endpoints)
  - [Word Operations](#word-operations)
  - [Search](#search)
  - [Baybayin](#baybayin)
  - [Relationships](#relationships)
  - [Statistics](#statistics)
  - [Import/Export](#importexport)
  - [Quality Assessment](#quality-assessment)
- [Database Schema](#database-schema)
- [Development](#development)
- [Testing](#testing)
- [Deployment](#deployment)
- [Contributing](#contributing)

## Installation

### Prerequisites

- Python 3.9+
- PostgreSQL 13+
- Redis (optional, for caching and rate limiting)

### Setup

1. Clone the repository:
   ```bash
   git clone https://github.com/your-org/fil-relex.git
   cd fil-relex/backend
   ```

2. Create a virtual environment:
   ```bash
   python -m venv venv
   source venv/bin/activate  # On Windows: venv\Scripts\activate
   ```

3. Install dependencies:
   ```bash
   pip install -r requirements.txt
   ```

4. Set up the database:
   ```bash
   python create_database.py
   ```

5. Run migrations:
   ```bash
   python -m flask db upgrade
   ```

## Configuration

Configuration is handled through environment variables or a `.env` file. Key configuration options include:

```
# Database settings
DATABASE_URL=postgresql://postgres:postgres@localhost:5432/fil_dict_db
DB_MIN_CONNECTIONS=5
DB_MAX_CONNECTIONS=20
DB_POOL_TIMEOUT=30
DB_POOL_RECYCLE=1800

# Redis settings (optional)
REDIS_ENABLED=false
REDIS_URL=redis://localhost:6379/0

# Application settings
SECRET_KEY=your-secret-key
ENVIRONMENT=development # or production
DEBUG=true
LOG_LEVEL=INFO

# Rate limiting
RATELIMIT_DEFAULT=200 per minute
RATELIMIT_STORAGE_URI=memory://
```

## Running the API

### Development Server

```bash
python serve.py
```

Or using Flask directly:

```bash
flask run --host=0.0.0.0 --port=5000
```

### Production Server

For production, we recommend using Gunicorn with Nginx:

```bash
gunicorn --bind 0.0.0.0:5000 "backend:create_app()" --workers 4 --threads 2
```

## API Endpoints

### Word Operations

#### GET /api/v2/words/{word_id}
Retrieve a word by its ID.

**Parameters:**
- `include_definitions` (boolean, default: true)
- `include_pronunciations` (boolean, default: true)
- `include_etymologies` (boolean, default: true)
- `include_relations` (boolean, default: true)
- `include_forms` (boolean, default: true)
- `include_templates` (boolean, default: true)
- `include_metadata` (boolean, default: true)

**Example Response:**
```json
{
  "id": 1234,
  "lemma": "halimbawa",
  "language_code": "fil",
  "pos": "n",
  "has_baybayin": true,
  "baybayin_form": "ᜑᜎᜒᜋ᜔ᜊᜏ",
  "definitions": [
    {
      "id": 5678,
      "definition_text": "An example or sample of something.",
      "examples": ["Mabigyan mo nga ako ng halimbawa."]
    }
  ],
  "completeness_score": 0.85
}
```

#### GET /api/v2/words
Get a list of words with pagination.

**Parameters:**
- `language_code` (string): Filter by language code
- `pos` (string): Filter by part of speech
- `limit` (integer, default: 50): Maximum number of results
- `offset` (integer, default: 0): Number of results to skip

#### GET /api/v2/random
Get a random word from the dictionary.

**Parameters:**
- `language` (string): Filter by language code
- `pos` (string): Filter by part of speech
- `has_etymology` (boolean): Filter for words with etymologies
- `has_baybayin` (boolean): Filter for words with Baybayin form
- `min_definitions` (integer): Minimum number of definitions

#### POST /api/v2/words
Create a new word.

**Request Body:**
```json
{
  "lemma": "bagong_salita",
  "language_code": "fil",
  "pos": "n",
  "has_baybayin": true,
  "baybayin_form": "ᜊᜄᜓᜅ᜔ᜐᜎᜒᜆ",
  "definitions": [
    {
      "definition_text": "A new word added to the dictionary.",
      "examples": ["Ito ay isang bagong_salita."]
    }
  ]
}
```

#### PUT /api/v2/words/{word_id}
Update an existing word.

#### DELETE /api/v2/words/{word_id}
Delete a word from the dictionary.

### Search

#### GET /api/v2/search
Search for words based on query text.

**Parameters:**
- `q` (string, required): Search query
- `mode` (string, default: "all"): Search mode ("all", "exact", "prefix", "suffix")
- `limit` (integer, default: 50): Maximum number of results
- `offset` (integer, default: 0): Number of results to skip
- `sort` (string, default: "relevance"): Sort order
- `order` (string, default: "desc"): Sort direction ("asc", "desc")
- `include_full` (boolean, default: false): Include full word details

**Example Request:**
```
GET /api/v2/search?q=bahay&mode=exact&limit=10
```

**Example Response:**
```json
{
  "count": 1,
  "results": [
    {
      "id": 456,
      "lemma": "bahay",
      "language_code": "fil",
      "pos": "n",
      "has_baybayin": true,
      "baybayin_form": "ᜊᜑᜌ᜔",
      "definitions": [
        {
          "definition_text": "A house or home.",
          "examples": ["Malaki ang bahay nila."]
        }
      ]
    }
  ]
}
```

#### GET /api/v2/search/advanced
Advanced search with additional filtering capabilities.

**Parameters:**
- All parameters from regular search
- `min_completeness` (float): Minimum completeness score (0-1)
- `max_completeness` (float): Maximum completeness score (0-1)
- `date_added_from` (datetime): Filter by creation date
- `date_added_to` (datetime): Filter by creation date
- `date_modified_from` (datetime): Filter by modification date
- `date_modified_to` (datetime): Filter by modification date
- `min_definition_count` (integer): Minimum definition count
- `max_definition_count` (integer): Maximum definition count
- `min_relation_count` (integer): Minimum relation count
- `max_relation_count` (integer): Maximum relation count
- `has_etymology` (boolean): Filter for words with etymologies
- `has_baybayin` (boolean): Filter for words with Baybayin form
- `has_pronunciation` (boolean): Filter for words with pronunciation
- `has_forms` (boolean): Filter for words with forms

#### GET /api/v2/search/suggestions
Get search suggestions for autocomplete functionality.

**Parameters:**
- `q` (string, required): Partial query for suggestions
- `limit` (integer, default: 10): Maximum number of suggestions
- `language` (string): Filter by language code

### Baybayin

#### GET /api/v2/baybayin/search
Search for words with specific Baybayin characters.

**Parameters:**
- `query` (string, required): Baybayin search query (must contain Baybayin characters)
- `language_code` (string): Filter by language
- `limit` (integer, default: 50): Maximum results
- `offset` (integer, default: 0): Pagination offset

**Example Request:**
```
GET /api/v2/baybayin/search?query=ᜊ&language_code=fil&limit=20
```

**Example Response:**
```json
{
  "count": 42,
  "results": [
    {
      "id": 123,
      "lemma": "baka",
      "language_code": "fil",
      "baybayin_form": "ᜊᜃ",
      "pos": "n",
      "completeness_score": 0.75
    }
  ]
}
```

#### GET /api/v2/baybayin/statistics
Get detailed statistics about Baybayin usage in the dictionary.

**Example Response:**
```json
{
  "overview": {
    "total_words": 15000,
    "with_baybayin": 3500,
    "percentage": 23.33
  },
  "by_language": [
    {
      "language_code": "fil",
      "total_words": 12000,
      "with_baybayin": 3200,
      "percentage": 26.67
    }
  ],
  "character_frequency": {
    "fil": {
      "ᜀ": 956,
      "ᜁ": 450,
      "ᜂ": 325
    }
  },
  "completeness": {
    "with_baybayin": 0.78,
    "without_baybayin": 0.62
  }
}
```

#### POST /api/v2/baybayin/convert
Convert romanized text to Baybayin script.

**Request Body:**
```json
{
  "text": "Magandang umaga",
  "language_code": "fil"
}
```

**Response:**
```json
{
  "original_text": "Magandang umaga",
  "baybayin_text": "ᜋᜄᜈ᜔ᜇᜅ᜔ ᜂᜋᜄ",
  "conversion_rate": 1.0
}
```

### Relationships

#### GET /api/v2/words/{word_id}/relations
Get all relationships for a word.

**Parameters:**
- `relation_type` (string): Filter by relation type
- `direction` (string, default: "all"): Relation direction ("incoming", "outgoing", "all")

#### POST /api/v2/relations
Create a new relationship between words.

**Request Body:**
```json
{
  "source_id": 123,
  "target_id": 456,
  "relation_type": "synonym",
  "weight": 1.0,
  "notes": "These words are direct synonyms"
}
```

#### GET /api/v2/words/{word_id}/semantic_network
Get a semantic network of related words.

**Parameters:**
- `depth` (integer, default: 2): Depth of relations to traverse
- `max_nodes` (integer, default: 50): Maximum nodes to return
- `include_definitions` (boolean, default: true): Include definitions

#### GET /api/v2/words/{word_id}/affixations
Get affixation relationships for a word.

#### GET /api/v2/relationships/types
Get available relationship types.

### Statistics

#### GET /api/v2/statistics
Get basic dictionary statistics.

**Example Response:**
```json
{
  "total_words": 25000,
  "total_definitions": 42000,
  "words_with_etymology": 8500,
  "words_with_baybayin": 3500,
  "words_by_language": {
    "fil": 20000,
    "ceb": 5000
  }
}
```

#### GET /api/v2/statistics/advanced
Get detailed dictionary statistics.

**Response includes:**
- Word counts by language, part of speech
- Definition statistics
- Relation statistics
- Completeness metrics
- Etymology coverage
- Baybayin coverage

#### GET /api/v2/statistics/timeseries
Get time-series statistics showing dictionary growth over time.

**Parameters:**
- `start_date` (date): Start of time range
- `end_date` (date): End of time range
- `interval` (string, default: "month"): Time interval ("day", "week", "month", "year")

**Example Response:**
```json
{
  "timeline": [
    {
      "date": "2022-01-01",
      "word_count": 20000,
      "definition_count": 35000,
      "baybayin_count": 2500
    },
    {
      "date": "2022-02-01",
      "word_count": 21000,
      "definition_count": 36500,
      "baybayin_count": 2800
    }
  ],
  "growth_rates": {
    "words": 5.0,
    "definitions": 4.3,
    "baybayin": 12.0
  }
}
```

#### GET /api/v2/statistics/language/{language_code}
Get detailed statistics for a specific language.

### Import/Export

#### GET /api/v2/export
Export dictionary data with filtering options.

**Parameters:**
- `language_code` (string): Filter by language
- `pos` (string): Filter by part of speech
- `has_baybayin` (boolean): Filter for words with Baybayin
- `min_completeness` (float): Minimum completeness score
- `created_after` (datetime): Filter by creation date
- `created_before` (datetime): Filter by creation date
- `updated_after` (datetime): Filter by modification date
- `updated_before` (datetime): Filter by modification date
- `format` (string, default: "json"): Export format ("json", "csv", "zip")
- `limit` (integer, default: 5000): Maximum number of records to export
- `offset` (integer, default: 0): Number of records to skip

#### POST /api/v2/import
Import dictionary data.

**Request Body:**
- Multipart form data with file upload
- JSON configuration for import settings

### Quality Assessment

#### GET /api/v2/quality_assessment
Analyze dictionary data quality, completeness, and identify issues.

**Parameters:**
- `language_code` (string): Filter by language
- `pos` (string): Filter by part of speech
- `min_completeness` (float): Minimum completeness score
- `max_completeness` (float): Maximum completeness score
- `issue_severity` (string, default: "all"): Filter by issue severity ("all", "critical", "warning", "info")
- `max_results` (integer, default: 100): Maximum number of issues to return

## Database Schema

The FilRelex database uses a relational schema with the following main tables:

- `words`: Core word entries
- `definitions`: Word definitions with examples
- `word_relations`: Relationships between words
- `etymologies`: Etymology information
- `pronunciations`: Pronunciation data
- `word_forms`: Inflected forms of words

For a complete schema, see the [database.py](./database.py) and [models.py](./models.py) files.

## Development

### Code Structure

- `app.py`: Main Flask application configuration
- `routes.py`: API endpoint definitions
- `baybayin_routes.py`: Baybayin-specific endpoints
- `database.py`: Database models and connection management
- `schema.py`: Request/response schemas using Marshmallow
- `security.py`: Authentication and security middleware
- `monitoring.py`: Logging and metrics collection

### Adding New Endpoints

1. Define your endpoint function in `routes.py` or an appropriate module
2. Add any required schemas in `schema.py`
3. Register the endpoint with the Flask blueprint
4. Update this documentation to reflect the new endpoint

### Coding Standards

- Follow PEP 8 style guidelines
- Write docstrings for all functions and classes
- Include type hints
- Write unit tests for new functionality

## Testing

### Running Tests

```bash
python run_tests.py
```

Or using pytest directly:

```bash
pytest
```

### Test Coverage

Generate a test coverage report:

```bash
python -m pytest --cov=backend tests/
```

## Deployment

### Docker

A Dockerfile is provided for containerized deployment:

```bash
docker build -t fil-relex-api .
docker run -p 5000:5000 fil-relex-api
```

### Docker Compose

For a complete development environment with PostgreSQL and Redis:

```bash
docker-compose up -d
```

### Production Deployment

For production deployments, we recommend:

1. Running behind Nginx or Apache as a reverse proxy
2. Using Gunicorn or uWSGI as the WSGI server
3. Enabling SSL/TLS
4. Configuring appropriate rate limits
5. Setting up monitoring and alerting

See the [deploy](./deploy) directory for deployment scripts and configurations.

## Contributing

### Submitting Pull Requests

1. Fork the repository
2. Create a new branch for your feature
3. Add your changes
4. Write tests for your changes
5. Run the test suite to ensure everything passes
6. Submit a pull request

### Reporting Issues

Please report issues using the issue tracker on GitHub, including:

- A clear description of the issue
- Steps to reproduce
- Expected behavior
- Actual behavior
- Any relevant logs or error messages

---

## License

Copyright © 2023 FilRelex Team. All rights reserved.
