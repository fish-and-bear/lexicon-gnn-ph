# Frontend Performance Fix Guide

This guide provides solutions to address the slow startup times and caching issues in the Filipino Root Word Explorer application.

## Key Issues Identified

1. **Excessive CSS Size and Complexity**
   - Large CSS files (WordExplorer.css: 31.8KB, WordDetails.css: 22.1KB)
   - Cascading CSS imports causing potential race conditions
   - Duplicate style rules, especially in dark mode overrides

2. **Circuit Breaker Implementation**
   - Aggressive localStorage clearing on startup
   - Inefficient API connection handling and caching
   - Blocking operations during initial render

3. **Multiple Utility Scripts**
   - Confusing array of CSS fix/backup/restore scripts
   - Lack of coordination between utility scripts

## Solutions Implemented

### 1. Performance Optimization Script (`performance-fix.js`)
- **Runs automatically in the browser on application startup.**
- Safely clears corrupted localStorage entries older than one day.
- Preserves important user settings (theme, history, etc.).
- Sets startup flags to defer non-critical operations.
- Preloads critical CSS files to improve rendering.

### 2. CSS Optimizer (`optimize-css.js`)
- Removes duplicate CSS rules.
- Organizes CSS imports properly.
- Combines duplicate media queries.
- Cleans up whitespace and formatting.

### 3. Circuit Breaker Improvements
- Reduced frequency of cache clearing.
- Added timeout to defer circuit breaker reset.
- Implemented tracking to prevent multiple resets.

### 4. Updated NPM Scripts
- `npm run optimize-css`: Runs the CSS optimization (can be run manually after CSS changes).
- `npm run clean-start`: Optimizes CSS and starts the development server.

## How to Fix Performance Issues

### Recommended Workflow

1. **Clear Browser Cache**: For the best results, especially after major changes, manually clear your browser's cache and localStorage for this site.
   - Chrome: DevTools (F12) -> Application -> Storage -> Clear site data.
   - Firefox: DevTools (F12) -> Storage -> Local Storage & Cache Storage -> Right-click and Delete All.

2. **Run the Clean Start Command**: This command optimizes CSS and starts the development server. The performance fixes (like cache cleaning) will run automatically in the browser.
   ```bash
   npm run clean-start
   ```

### Ongoing Maintenance

- **After significant CSS changes**: Run `npm run optimize-css` manually.
- **If startup becomes slow again**: Manually clear browser cache/localStorage as described in step 1 of the workflow.
The `performance-fix.js` script will handle routine cache cleanup automatically on each page load.

## Long-Term Improvements

1. **CSS Architecture Improvements**
   - Consider migrating to CSS-in-JS or styled-components
   - Split large component CSS files into modular files
   - Use CSS variables more consistently

2. **API Optimization**
   - Implement proper caching with service workers
   - Use React Query or SWR for data fetching
   - Add proper loading states to prevent UI blocking

3. **Circuit Breaker Redesign**
   - Move circuit breaker state to React context
   - Use a more efficient approach to API fallbacks
   - Consider using IndexedDB instead of localStorage for caching

## Monitoring

To verify the performance improvements:
1. Open Chrome DevTools (F12)
2. Go to the Performance tab
3. Record a full page load
4. Check for reduced time to interactive and layout shifts

If CSS optimization is working correctly, you should see:
- Faster initial page load (under 2 seconds)
- Smoother theme switching
- No flash of unstyled content

## Troubleshooting

If issues persist:
1. Delete `node_modules` and reinstall dependencies
2. Clear all browser cache and cookies
3. Try running in a private/incognito window
4. Check console for error messages
5. Verify localStorage contents using DevTools Application tab 